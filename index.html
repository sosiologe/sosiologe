<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>sosiologe</title>
<style>
body{margin:0;font-family:Arial;background:#0f172a;color:#fff}
header{display:flex;justify-content:space-between;align-items:center;padding:10px;background:#020617}
button{background:#2563eb;border:none;color:#fff;padding:6px 10px;border-radius:6px}
input,textarea{width:100%;margin:4px 0;padding:6px;border-radius:6px;border:none}
#auth,#app,#profile,#admin{display:none;padding:15px}
.post{background:#020617;margin:8px 0;padding:10px;border-radius:8px}
small{color:#94a3b8}
.like{cursor:pointer;color:#38bdf8}
.comment{margin-left:10px;font-size:14px}
</style>
</head>
<body>

<header>
<b>sosiologe</b>
<button onclick="openProfile()">üë§</button>
</header>

<div id="auth">
<h3>–í—Ö–æ–¥ / –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</h3>
<input id="login" placeholder="–õ–æ–≥–∏–Ω">
<input id="name" placeholder="–ò–º—è">
<input id="pass" type="password" placeholder="–ü–∞—Ä–æ–ª—å">
<button onclick="register()">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</button>
<button onclick="loginUser()">–í—Ö–æ–¥</button>
</div>

<div id="app">
<textarea id="postText" placeholder="–ß—Ç–æ –Ω–æ–≤–æ–≥–æ?"></textarea>
<button onclick="addPost()">–û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å</button>
<div id="posts"></div>
</div>

<div id="profile">
<h3>–ü—Ä–æ—Ñ–∏–ª—å</h3>
<input id="pname">
<input id="pavatar" placeholder="URL –∞–≤–∞—Ç–∞—Ä–∫–∏">
<button onclick="saveProfile()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
<button onclick="logout()">–í—ã–π—Ç–∏</button>
</div>

<div id="admin">
<h3>–ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å</h3>
<div id="users"></div>
</div>

<script>
let users=JSON.parse(localStorage.users||"{}");
let posts=JSON.parse(localStorage.posts||"[]");
let current=localStorage.current||null;

function save(){localStorage.users=JSON.stringify(users);localStorage.posts=JSON.stringify(posts)}

function show(id){
["auth","app","profile","admin"].forEach(x=>document.getElementById(x).style.display="none");
document.getElementById(id).style.display="block";
}

function register(){
let l=login.value,p=pass.value,n=name.value;
if(users[l])return alert("–£–∂–µ –µ—Å—Ç—å");
users[l]={pass:p,name:n,avatar:"",banned:false};
save();alert("–ì–æ—Ç–æ–≤–æ");
}

function loginUser(){
let l=login.value,p=pass.value;
if(!users[l]||users[l].pass!=p)return alert("–û—à–∏–±–∫–∞");
if(users[l].banned)return alert("–í—ã –∑–∞–±–∞–Ω–µ–Ω—ã");
current=l;localStorage.current=l;
render();
}

function logout(){localStorage.current=null;location.reload()}

function render(){
show("app");
if(current==="admin")show("admin");
drawPosts();
}

function addPost(){
posts.push({text:postText.value,user:current,likes:[],comments:[],time:Date.now()});
postText.value="";save();drawPosts();
}

function drawPosts(){
posts.sort((a,b)=>b.time-a.time);
postsEl=document.getElementById("posts");
postsEl.innerHTML="";
posts.forEach((p,i)=>{
let d=document.createElement("div");d.className="post";
d.innerHTML=`<b>${users[p.user].name}</b><br>${p.text}
<br><span class="like" onclick="like(${i})">‚ù§Ô∏è ${p.likes.length}</span>
${p.user===current||current==="admin"?`<button onclick="del(${i})">‚ùå</button>`:""}
<div>${p.comments.map(c=>`<div class="comment"><b>${users[c.u].name}:</b> ${c.t}</div>`).join("")}</div>
<input placeholder="–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π" onkeydown="if(event.key==='Enter')comment(${i},this.value,this)">
`;
postsEl.appendChild(d);
});
}

function like(i){
let p=posts[i];
if(!p.likes.includes(current))p.likes.push(current);
save();drawPosts();
}

function comment(i,t,el){
posts[i].comments.push({u:current,t});el.value="";save();drawPosts();
}

function del(i){posts.splice(i,1);save();drawPosts()}

function openProfile(){
show("profile");
pname.value=users[current].name;
pavatar.value=users[current].avatar;
}

function saveProfile(){
users[current].name=pname.value;
users[current].avatar=pavatar.value;
save();alert("–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ");
}

if(current)render();else show("auth");

if(current==="admin"){
let u=document.getElementById("users");
u.innerHTML=Object.keys(users).map(x=>`
<div>${x} ${users[x].banned?"‚ùå":""}
<button onclick="users['${x}'].banned=!users['${x}'].banned;save();location.reload()">–ë–∞–Ω</button>
</div>`).join("");
}
</script>

</body>
</html>
