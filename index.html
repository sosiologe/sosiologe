<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>sosiologe</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
body { font-family: Arial; background:#111; color:#fff; margin:20px }
.card { background:#1e1e1e; padding:15px; border-radius:10px; margin-bottom:20px }
button { padding:6px 10px; cursor:pointer }
input, select { padding:6px }
.like { color:red; cursor:pointer }
</style>
</head>
<body>

<h2>sosiologe</h2>

<div class="card">
<h3>üí± –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –≤–∞–ª—é—Ç</h3>
<input id="amount" type="number" value="1">
<select id="from">
<option>USD</option><option>EUR</option><option>RUB</option>
</select>
<select id="to">
<option>EUR</option><option>USD</option><option>RUB</option>
</select>
<button onclick="convert()">–ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
<p id="result"></p>
<canvas id="chart"></canvas>
</div>

<div class="card">
<h3>üì∞ –ü–æ—Å—Ç—ã</h3>
<input id="postText" placeholder="–ß—Ç–æ –Ω–æ–≤–æ–≥–æ?">
<button onclick="addPost()">–û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å</button>
<div id="posts"></div>
</div>

<script>
let userId = localStorage.getItem("uid") || Math.random().toString(36).slice(2);
localStorage.setItem("uid", userId);

async function convert() {
  document.getElementById("result").innerText = "–ó–∞–≥—Ä—É–∑–∫–∞...";
  let a = amount.value;
  let f = from.value;
  let t = to.value;
  let r = await fetch("https://api.exchangerate.host/latest?base="+f);
  let d = await r.json();
  let res = (a * d.rates[t]).toFixed(2);
  result.innerText = `${a} ${f} = ${res} ${t}`;
  drawChart(d.rates[t]);
}

let chart;
function drawChart(rate) {
  if(chart) chart.destroy();
  chart = new Chart(document.getElementById("chart"), {
    type:"line",
    data:{ labels:["–ö—É—Ä—Å"], datasets:[{data:[rate]}] }
  });
}

let posts = JSON.parse(localStorage.getItem("posts")||"[]");

function addPost() {
  posts.unshift({ text:postText.value, likes:[], comments:[] });
  localStorage.setItem("posts",JSON.stringify(posts));
  postText.value="";
  renderPosts();
}

function renderPosts() {
  postsDiv.innerHTML="";
  posts.forEach((p,i)=>{
    let liked = p.likes.includes(userId);
    postsDiv.innerHTML += `
    <div class="card">
      <p>${p.text}</p>
      <span class="like" onclick="like(${i})">
      ‚ù§Ô∏è ${p.likes.length} ${liked?"(—Ç—ã –ª–∞–π–∫–Ω—É–ª)":""}
      </span>
    </div>`;
  });
}

function like(i){
  let p = posts[i];
  if(!p.likes.includes(userId)) p.likes.push(userId);
  localStorage.setItem("posts",JSON.stringify(posts));
  renderPosts();
}

renderPosts();
</script>

</body>
</html>
